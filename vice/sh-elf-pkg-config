#!/bin/bash

# Reset pkg-config variables to ensure we're not polluted by host libraries
export PKG_CONFIG_DIR=
export PKG_CONFIG_PATH=
export PKG_CONFIG_SYSROOT_DIR=
PKG_CONFIG_LIBDIR=""

KOS_PORT_INCLUDE_DIR="/opt/toolchains/dc/kos-ports/include/"

case "$1" in
    --cflags)
        if [[ "$2" == "SDL_image >= 1.2.0" ]]; then
            echo "-D_arch_dreamcast -I$KOS_PORT_INCLUDE_DIR -IKOS_PORT_INCLUDE_DIR/SDL"
        else
            echo "-D_arch_dreamcast $KOS_CFLAGS"
        fi
        ;;
    --libs)
        if [[ "$2" == "SDL_image >= 1.2.0" ]]; then
            echo "-L/opt/toolchains/dc/kos-ports/lib -lSDL -lSDL_image"
        else
            echo "$KOS_LIBS"
        fi
        ;;
    --sdlcflags)
        echo "-D_arch_dreamcast -I$KOS_PORT_INCLUDE_DIR -IKOS_PORT_INCLUDE_DIR/SDL"
        ;;
    --sdllibs)
        echo "-L/opt/toolchains/dc/kos-ports/lib -lSDL"
        ;;
    --exists)
        if [[ "$2" == "SDL_image >= 1.2.0" ]]; then
            exit 0
        else
            exit 1
        fi
        ;;
    --print-errors)
        # This is usually used with other flags, here we handle it with exists for simplicity
        if [[ "$2" == "SDL_image >= 1.2.0" ]]; then
            exit 0
        else
            echo "Error: Unsupported package '$2'."
            exit 1
        fi
        ;;
    --errors-to-stdout)
        # This should probably not be called by itself, but itâ€™s here for completeness
        ;;
    --atleast-pkgconfig-version)
        if [[ "$2" == "" ]]; then
            echo "Error: Please specify a version number."
            exit 1
        fi
        required_version="$2"
        if [[ "$required_version" == 0.9* ]]; then
            echo "yes"
        else
            echo "no"
        fi
        ;;
    --version)
        echo "0.9.1" # made-up version number
        ;;
    *)
        echo "Usage: pkg-config [--cflags | --libs | --sdlcflags | --sdllibs | --exists | --print-errors | --errors-to-stdout | --version]"
        exit 1
        ;;
esac
