<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>x128: coding guidelines</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../vice-logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">x128<span id="projectnumber">&#160;3.8</span>
   </div>
   <div id="projectbrief">Versatile Commodore Emulator and Virtual Commodore Environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d87/howtocode.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">coding guidelines </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><tt>
VICE project coding guidelines<br>
==============================<br>
<br>
This document is intended to set some guidelines for people wanting to<br>
contribute code to the VICE project.<br>
<br>
There are two distinct parts to the VICE source code, the architecture code<br>
parts which are located in src/arch, and the common code parts which are<br>
located everywhere in src except in src/arch.<br>
<br>
The common code is used by all supported architectures and therefor needs to be<br>
as portable as possible.<br>
<br>
To achieve this portability, and to keep the codebase tidy and clean, some<br>
guidelines have to be followed.<br>
<br>
Project Folders Hierarchy Descriptions<br>
--------------------------------------<br>
<br>
Here are short descriptions of the project code folders and their functions:<br>
<br>
generally:<br>
<br>
- All code in the root of the tree is common code that contains no architecture<br>
&nbsp;&nbsp;specific parts.<br>
<br>
- 3rd party libraries and headers which have been pulled into the sourcetree<br>
&nbsp;&nbsp;live in src/lib/ . Files in this directory tree do not have to follow the<br>
&nbsp;&nbsp;codestyle lined out here, as they could be replaced/updated at any time.<br>
<br>
- Architecture specific code lives in src/arch/shared.<br>
<br>
- Code that is specific to a (G)UI should live in src/arch/&lt;gui&gt;.<br>
<br>
in detail:<br>
<br>
build<br>
 beos<br>
 github-actions<br>
 macOS<br>
 mingw<br>
&nbsp;&nbsp;docker<br>
&nbsp;&nbsp;frankenvice<br>
<br>
data<br>
 C128<br>
 C64<br>
 C64DTV<br>
 CBM-II<br>
 common<br>
 DRIVES<br>
 GLSL<br>
 PET<br>
 PLUS4<br>
 PRINTER<br>
 SCPU64<br>
 VIC20<br>
<br>
doc<br>
 building<br>
 html<br>
&nbsp;&nbsp;fonts<br>
&nbsp;&nbsp;images<br>
 readmes<br>
 vim<br>
&nbsp;&nbsp;ftdetect<br>
&nbsp;&nbsp;syntax<br>
<br>
m4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- m4 code used by the buildsystem<br>
<br>
src&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - common code<br>
 arch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - architecture specific code for various platforms (win, unix, amigaos, etc)<br>
&nbsp;&nbsp;gtk3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- gtk3 ui<br>
&nbsp;&nbsp; data<br>
&nbsp;&nbsp;&nbsp;&nbsp;macos<br>
&nbsp;&nbsp;&nbsp;&nbsp;unix<br>
&nbsp;&nbsp;&nbsp;&nbsp;win32<br>
&nbsp;&nbsp; joystickdrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- gtk joystick handling<br>
&nbsp;&nbsp; novte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- gtk monitor console<br>
&nbsp;&nbsp; Resources<br>
&nbsp;&nbsp; widgets<br>
&nbsp;&nbsp;&nbsp;&nbsp;base<br>
&nbsp;&nbsp;headless&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- headless "ui"<br>
&nbsp;&nbsp;sdl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - sdl1 and sdl2 ui<br>
&nbsp;&nbsp; Resources<br>
&nbsp;&nbsp;shared<br>
&nbsp;&nbsp; hwsiddrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - drivers for hardware SID cards, mostly using direct I/O and thus obsolete<br>
&nbsp;&nbsp; iodrv<br>
&nbsp;&nbsp; mididrv<br>
&nbsp;&nbsp; samplerdrv<br>
&nbsp;&nbsp; socketdrv<br>
&nbsp;&nbsp; sounddrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - framework specific sound drivers<br>
&nbsp;&nbsp;systemheaderoverride&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- headers that override headers usually provided by system libraries<br>
&nbsp;&nbsp; gtk<br>
<br>
 buildtools<br>
<br>
 c128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - commodore 128 specific code<br>
 c64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- c64 specific code<br>
&nbsp;&nbsp;cart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- c64 cartridge specific code<br>
 c64dtv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - c64 direct tv specific code<br>
 cbm2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Commodore CBM-II computer emulator<br>
&nbsp;&nbsp;cart<br>
 pet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- pet computer specific emulation code<br>
 plus4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- commodore plus4 specific code<br>
&nbsp;&nbsp;cart<br>
 scpu64<br>
 vic20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- commodore vic20 specific code<br>
&nbsp;&nbsp;cart<br>
<br>
 core&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - various chip emulations (CIA, VIA and Cart specific chip emulations)<br>
&nbsp;&nbsp;rtc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - real time clock emulation used in some devices (fd2000/4000, ide64, etc..)<br>
 crtc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - CRTC emulation<br>
 resid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- cycle exact sid engine (made by dag lem)<br>
 resid-dtv<br>
 sid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- SID chip interface and emulation for fallback sid engine (fastsid)<br>
 vdc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- MOS8563 VDC emulation<br>
 vicii&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- almost cycle exact VICII emulation code for x64, x128, xcbm2, and x64dtv<br>
 viciisc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- more cycle exact then vicii code emulation used in x64sc and xscpu64<br>
<br>
 diag<br>
<br>
 diskimage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- various file types support (.d64, .d81, etc..)<br>
 imagecontents&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- disk and tape directory interface<br>
<br>
 iecbus&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - iec bus handling<br>
 parallel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ieee488 emulation code<br>
 serial&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - iec interface code and real iec access (for using real drives on usb with vice)<br>
<br>
 drive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- various disk drive hardware emulations and bus systems used (iec or ieee)<br>
&nbsp;&nbsp;iec<br>
&nbsp;&nbsp; c64exp<br>
&nbsp;&nbsp; plus4exp<br>
&nbsp;&nbsp;iec128dcr<br>
&nbsp;&nbsp;iecieee<br>
&nbsp;&nbsp;ieee<br>
&nbsp;&nbsp;tcbm<br>
 vdrive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - virtual drives code, opposed to "true drive emulation" found in drive folder<br>
<br>
 fileio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - for accessing prg files directly<br>
 fsdevice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - for host filesystem as if an iec device is used<br>
<br>
 hvsc<br>
 joyport<br>
 monitor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- code for built-in monitor<br>
 <br>
 datasette<br>
 tape&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - tape drive specific emulation and T64 support<br>
 tapeport<br>
<br>
 userport&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - userport device emulation code<br>
<br>
 raster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - raster-based video chip emulation<br>
 video&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- pixel framebuffer to physical screen interface code<br>
<br>
 lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- anything related to external libraries (ffmpeg codec, etc.. see above)<br>
&nbsp;&nbsp;linenoise-ng<br>
&nbsp;&nbsp;p64<br>
<br>
 tools<br>
&nbsp;&nbsp;cartconv<br>
&nbsp;&nbsp;petcat<br>
<br>
 gfxoutputdrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - screen capture (image and video drivers)<br>
 printerdrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - specific printer type emulation and drivers<br>
 rs232drv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - rs232 communication and modem code for interfacing with arch specific drivers<br>
<br>
<br>
Cosmetic guidelines for all code<br>
--------------------------------<br>
<br>
To keep the code tidy and easy to follow please read the following statements:<br>
<br>
<br>
- Don't use C++ style comments in C code (// comment), use C-style comments<br>
&nbsp;&nbsp;instead (/* comment */). This goes for C99 code as well.<br>
<br>
&nbsp;&nbsp;You may use the ./checkstyle.sh script to find dangling c++ comments:<br>
<br>
&nbsp;&nbsp;$ ./checkstyle.sh comments<br>
<br>
- We strictly indent by 4 spaces. Don't use mixtures of tabs and spaces as<br>
&nbsp;&nbsp;indentation, using 4 spaces per level will make the code look the same no<br>
&nbsp;&nbsp;matter what editor you use.<br>
<br>
&nbsp;&nbsp;You may use the checkstyle.sh script to find dangling tabs:<br>
<br>
&nbsp;&nbsp;$ ./checkstyle.sh tabs<br>
<br>
- Avoid trailing whitespace. Many editors can show this and remove this.<br>
<br>
&nbsp;&nbsp;You may use the checkstyle.sh script to find trailing whitespace:<br>
<br>
&nbsp;&nbsp;$ ./checkstyle.sh whitespace<br>
<br>
- Refrain from using any non ASCII characters in source files, unless absolutely<br>
&nbsp;&nbsp;necessary. Previously a common trap were copyright headers - make sure to<br>
&nbsp;&nbsp;use latin letters only to write your name etc. or in other words: such chars<br>
&nbsp;&nbsp;should not be used anywhere, except in a few selected (usually translation<br>
&nbsp;&nbsp;related) files that contain tables of strings.<br>
&nbsp;&nbsp;The reason for this is that various tools get confused or even choke on any-<br>
&nbsp;&nbsp;thing that isnt the encoding they expect (and plain ascii always works). It<br>
&nbsp;&nbsp;also ensures that all files can be edited by anyone at any time without intro-<br>
&nbsp;&nbsp;ducing weird side effects.<br>
&nbsp;&nbsp;On a *nix system you may use the "file" command to check the files you<br>
&nbsp;&nbsp;changed, normally it should always say "ASCII text" (not ISO-8859, and<br>
&nbsp;&nbsp;definately not UTF-8 Unicode).<br>
<br>
&nbsp;&nbsp;current exceptions from this rule are:<br>
<br>
&nbsp;&nbsp;src/infocontrib.h: ISO-8859 (generated file)<br>
<br>
&nbsp;&nbsp;Keep in mind that editing the translation related files need special care,<br>
&nbsp;&nbsp;make sure not to mess up the file by somehow converting the encoding!<br>
<br>
&nbsp;&nbsp;You may use the findhacks.sh script in src/ to check all sourcefiles and find<br>
&nbsp;&nbsp;any that contain non ascii characters:<br>
<br>
&nbsp;&nbsp;$ ./findhacks.sh encoding<br>
<br>
- Use the types in &lt;stdint.h&gt; for fixed-width types, so `uint8_t` rather than<br>
&nbsp;&nbsp;`BYTE`, `uint16_t` for `WORD` and `uint32_t` for `DWORD`.<br>
<br>
- Generally put the opening brace of a block at the end of the line ("cuddling"<br>
&nbsp;&nbsp;braces style), except at the beginning of a function, ie:<br>
<br>
&nbsp;&nbsp;void foo(int bar)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bar) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* ... */<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
<br>
<br>
- No variable declarations after the first line of code, some compilers<br>
&nbsp;&nbsp;just can't handle it.<br>
<br>
<br>
- One variable declaration per line, and especially don't mix plain types with<br>
&nbsp;&nbsp;pointers.<br>
<br>
&nbsp;&nbsp;Don't do this:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;int foo, bar, *huppel;<br>
<br>
&nbsp;&nbsp;Do this:<br>
&nbsp;&nbsp;&nbsp;&nbsp;int foo;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int bar;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int *huppel;<br>
<br>
&nbsp;&nbsp;Might look short and clever, but as soon as you want to change a single type,<br>
&nbsp;&nbsp;you'll either screw them all up, or have to split them anyway. Just don't.<br>
<br>
<br>
&nbsp;&nbsp;New block-level declarations are fine:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (foo) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int bar = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* code using bar */<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;Perfectly valid even in C89, if a compiler can't handle this, get a proper<br>
&nbsp;&nbsp;compiler.<br>
<br>
- For 'if' and 'for' always use braces.<br>
&nbsp;&nbsp;examples:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (foo) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (foo) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;} else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i &lt; 255; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
- A keyword should be followed by a space, so:<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (foo == 0) { ... }<br>
&nbsp;&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(foo == 0) { ... }<br>
<br>
&nbsp;&nbsp;Exception: the sizeof operator, using sizeof as a "function" on a type should<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; not use spaces, ie: sizeof(int), however using sizeof on an object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; should use spaces (ie: int *i; sizeof *i)<br>
<br>
- Binary operators: use spaces around binary operators:<br>
&nbsp;&nbsp;&nbsp;&nbsp;int i = 1 + 2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;unsigned int i &lt;&lt;= 3;<br>
<br>
&nbsp;&nbsp;But please don't use them with when accessing members of an object:<br>
&nbsp;&nbsp;&nbsp;&nbsp;foo-&gt;bar, not foo -&gt; bar.<br>
<br>
- Unary operators:<br>
&nbsp;&nbsp;Don't use spaces when using unary operators:<br>
&nbsp;&nbsp;&nbsp;&nbsp;~0 is fine,<br>
&nbsp;&nbsp;&nbsp;&nbsp;~ 0 isn't.<br>
<br>
- Use boolean logic only when the context is clear and the thing tested can<br>
&nbsp;&nbsp;actually be considered boolean:<br>
<br>
&nbsp;&nbsp;Basically:<br>
&nbsp;&nbsp;&nbsp;&nbsp;`if (!strcmp(a b))` is WRONG since strcmp() returns three different values,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0 when equal (which is what the ! tests against), &lt; 0 when a &lt; b, and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&gt; 0 when b &gt; a.<br>
&nbsp;&nbsp;&nbsp;&nbsp;So please use `if (strcmp(a, b) == 0)`, a little more typing, but much more<br>
&nbsp;&nbsp;&nbsp;&nbsp;clear.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;We also seem to have a lot of functions returning either 0 on success, or<br>
&nbsp;&nbsp;&nbsp;&nbsp;-1 on error. And a lot of code using boolean logic on the return value.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Please don't. Unfortunately this is so wide spread in the VICE code it's<br>
&nbsp;&nbsp;&nbsp;&nbsp;hard to fix.<br>
<br>
- Use braces even when they are not really required, it makes expressions<br>
&nbsp;&nbsp;easier to read and allows to use advanced highlighting in the editor, ie<br>
<br>
&nbsp;&nbsp;if ((a + b) &amp;&amp; (c != d)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* ... */<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;instead of<br>
<br>
&nbsp;&nbsp;if (a + b &amp;&amp; c != d) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* ... */<br>
&nbsp;&nbsp;}<br>
<br>
- No 'clever' while/do trickery, unless required for preprocessor code. The<br>
&nbsp;&nbsp;following looks clever:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;while (*s++ != '\0');<br>
<br>
&nbsp;&nbsp;But this is clearer and will generate the same object code:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;while (*s != '\0') {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
- To give the code a consistent look use specifiers named with prefixes<br>
&nbsp;&nbsp;like in the following examples:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct foobar_s {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;typedef ... foobar_t;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;enum stuff_e {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;union many_u {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
<br>
&nbsp;&nbsp;Of course combinations may be used:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;typedef struct foobar_s {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;} foobar_t;<br>
<br>
&nbsp;&nbsp;Exceptions are basic type like BYTE, WORD, DWORD and code that follows a<br>
&nbsp;&nbsp;coding style of a certain architecture, e.g. UI code.<br>
<br>
- Preprocessor macros which define constants or enumeration values should<br>
&nbsp;&nbsp;be written in capital letters.<br>
<br>
&nbsp;&nbsp; #define FORTYTWO 42<br>
<br>
&nbsp;&nbsp; typedef numbers_e {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUM_ZERO,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUM_ONE<br>
&nbsp;&nbsp; } numbers_t;<br>
<br>
- Properly document any fall through in switch/case constructs:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;switch (foo) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 42:&nbsp;&nbsp;&nbsp;&nbsp;/* fall through */<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 69:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hehe();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
<br>
Symbols in ifdefs<br>
-----------------<br>
<br>
- If tests for a certain (G)UI are needed, they can use the following symbols.<br>
&nbsp;&nbsp;No other symbols should be defined to "shortcut" certain combinations!<br>
<br>
&nbsp;&nbsp;USE_SDLUI<br>
&nbsp;&nbsp;USE_SDL2UI<br>
&nbsp;&nbsp;USE_GTK3UI<br>
&nbsp;&nbsp;USE_HEADLESSUI<br>
<br>
&nbsp;&nbsp;Remember this kind of tests should ideally not occur anywhere in common code -<br>
&nbsp;&nbsp;but if they can not be avoided, they should always come with a comment that<br>
&nbsp;&nbsp;tells why this test exists.<br>
<br>
- For tests for a certain architecture/operating system the build system defines<br>
&nbsp;&nbsp;some symbols. No other symbols should be used for this, in particular not the<br>
&nbsp;&nbsp;various things defined by compilers or system libraries. Eg do not use<br>
&nbsp;&nbsp;"_WIN32" when you need to check for "is this windows?", use "WINDOWS_COMPILE"<br>
&nbsp;&nbsp;instead.<br>
<br>
&nbsp;&nbsp;The architecture symbols are nested in a hierarchic way:<br>
<br>
&nbsp;&nbsp;WINDOWS_COMPILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - compiling for windows (32bit AND 64bit)<br>
&nbsp;&nbsp;&nbsp;&nbsp;WIN64_COMPILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - compiling for 64bit windows<br>
&nbsp;&nbsp;UNIX_COMPILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- any *nix system<br>
&nbsp;&nbsp;&nbsp;&nbsp;LINUX_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;MACOS_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;BSD_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FREEBSD_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRAGONFLYBSD_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NETBSD_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPENBSD_COMPILE<br>
&nbsp;&nbsp;BEOS_COMPILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;HAIKU_COMPILE<br>
<br>
&nbsp;&nbsp;Remember this kind of tests should ideally not occur anywhere in common code -<br>
&nbsp;&nbsp;but if they can not be avoided, they should always come with a comment that<br>
&nbsp;&nbsp;tells why this test exists.<br>
<br>
- When using headers which are tested for in configure.proto don't assume they<br>
&nbsp;&nbsp;exist, use the #ifdef HAVE_*_H instead.<br>
<br>
&nbsp;&nbsp; #ifdef HAVE_SYS_TYPES_H<br>
&nbsp;&nbsp; #include &lt;sys/types.h&gt;<br>
&nbsp;&nbsp; #endif<br>
<br>
&nbsp;&nbsp;you can look at src/config.h to see which symbols are available<br>
<br>
- When adding header files use VICE_*_H as shown in the following example:<br>
<br>
&nbsp;&nbsp; #ifndef VICE_RS232_H<br>
&nbsp;&nbsp; #define VICE_RS232_H<br>
<br>
&nbsp;&nbsp; ...code...<br>
<br>
&nbsp;&nbsp; #endif<br>
<br>
<br>
Common code guidelines<br>
----------------------<br>
<br>
Many different compilers may be used to compile the common code parts, although<br>
in practise this will be GCC, Clang or MSVC.<br>
<br>
- There should be no compiler specific hacks anywhere and no ifdefs checking<br>
&nbsp;&nbsp;for specific compilers. The only exception to this rule is the global vice.h.<br>
&nbsp;&nbsp;The same is true for CPU/Arch specific checks.<br>
<br>
&nbsp;&nbsp;There are still some of these compiler specific hacks dangling around, all of<br>
&nbsp;&nbsp;which are subject for removal. Do not add any new ones :)<br>
<br>
&nbsp;&nbsp;You can find such things using ./src/findhacks.sh ccarchdep<br>
<br>
- Generally no arch specific hacks and ifdefs should be present in common code.<br>
&nbsp;&nbsp;All arch specific code should be abstracted into functions which then live in<br>
&nbsp;&nbsp;src/arch/shared. Code that is specific to a GUI should live in src/arch/&lt;gui&gt;.<br>
<br>
&nbsp;&nbsp;When a platform specific ifdef can not be avoided in common code, it should<br>
&nbsp;&nbsp;always come with a comment that explains why exactly that ifdef exists and<br>
&nbsp;&nbsp;what the respective portion of code is supposed to do.<br>
<br>
&nbsp;&nbsp;Since this rule did not exist in the past, there is still a lot of arch <br>
&nbsp;&nbsp;specific code around elsewhere that needs to be moved - this is no excuse for<br>
&nbsp;&nbsp;ignoring the rule when writing new code however.<br>
<br>
&nbsp;&nbsp;You can find such thing using: ./src/findhacks.sh archdep<br>
<br>
<br>
Documentation<br>
-------------<br>
<br>
Please add documentation to code you add or alter.<br>
<br>
We use Doxygen to document our code, add docblocks for each public function or<br>
data structure, at a minimum. Adding documentation is boring and the discipline<br>
to do that is even harder, but it'll help out your fellow (future) devs and<br>
probably even you after not working on a piece of code for some time. (Also<br>
see Doxygen-Howto.txt)<br>
<br>
This also applies to the user manual - when you are adding new features, please<br>
document it in vice.texi (see Documentation-Howto.txt)<br>
<br>
<br>
Adding new files to the svn repo<br>
--------------------------------<br>
<br>
When adding a *nix script file use the following svn properties:<br>
<br>
svn:eol-style&nbsp;&nbsp; LF<br>
svn:mime-type&nbsp;&nbsp; text/plain<br>
svn:executable&nbsp;&nbsp;*<br>
<br>
When adding a windows/dos batch file use the following svn properties:<br>
<br>
svn:eol-style&nbsp;&nbsp; CRLF<br>
svn:mime-type&nbsp;&nbsp; text/plain<br>
svn:executable&nbsp;&nbsp;*<br>
<br>
When adding a non-text file use only the correct mime-type.<br>
<br>
For all other files use the following svn properties:<br>
<br>
svn:eol-style&nbsp;&nbsp; native<br>
svn:mime-type&nbsp;&nbsp; text/plain<br>
</tt>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Developer Information</a></li>
    <li class="footer">Generated on Sun Jun 16 2024 16:43:06 for x128 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
