<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vsid: How to make a Release</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../vice-logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">vsid<span id="projectnumber">&#160;3.8</span>
   </div>
   <div id="projectbrief">Versatile Commodore Emulator and Virtual Commodore Environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d8b/howtorelease.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to make a Release </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><tt>
Prerequisites:<br>
--------------<br>
<br>
- update NEWS<br>
<br>
to get a list of all changes since last release you can use svn log like this:<br>
<br>
$ svn log -r &lt;rev of last release&gt;:&lt;current rev&gt; &gt; log.txt<br>
<br>
you can look up the revision of the last release in the tags directory in the<br>
repo: https://sourceforge.net/p/vice-emu/code/HEAD/tree/tags/<br>
<br>
- update the html pages in doc/html (index.html, windows.html, macosx.html). use<br>
&nbsp;&nbsp;the checklinks.sh script to check the links.<br>
<br>
$ cd doc/html<br>
$ ./checklinks.sh<br>
$ cd ../..<br>
<br>
- update vice.texi. use checkdoc.mak to find missing resources and options in<br>
&nbsp;&nbsp;the documentation.<br>
<br>
$ make<br>
$ cd doc<br>
$ make -f checkdoc.mak full<br>
$ cd ..<br>
<br>
&nbsp;&nbsp;(this only works for in-tree builds and with --enable-x64)<br>
<br>
- make sure the list of team members is correct (vice.texi, infocontrib.sed)<br>
&nbsp;&nbsp;vice.texi contains the author list twice, once under "@c<br>
&nbsp;&nbsp;---vice-core-team---", and once under "@node Copyright"<br>
<br>
- run src/buildtools/updatereadme.sh to update README and vicedate.h with the<br>
&nbsp;&nbsp;current year.<br>
- make sure to 'touch' vice.texi so that the current year will be put into all<br>
&nbsp;&nbsp;needed files.<br>
<br>
$ touch doc/vice.texi<br>
$ ./src/buildtools/genvicedate_h.sh<br>
<br>
- after changing any of the above, make sure to run "make" so the changes will<br>
&nbsp;&nbsp;propagate to various files, and then commit the changed files.<br>
<br>
$ make all<br>
$ svn commit -m "preparing release - no more committing until after the release is done!"<br>
<br>
- ANNOUNCE A CODE FREEZE ;)<br>
<br>
- make sure the version in configure.ac is updated:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;m4_define(vice_version_major, 3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;m4_define(vice_version_minor, 8)<br>
&nbsp;&nbsp;&nbsp;&nbsp;m4_define(vice_version_build, 0)<br>
<br>
&nbsp;&nbsp;These three defines are all that is needed for a version number, the absence<br>
&nbsp;&nbsp;or presence of an SVN revision determines if a release is a point release or<br>
&nbsp;&nbsp;a development release.<br>
&nbsp;&nbsp;We do not use odd/even MINOR/BUILD numbering for development/stable releases.<br>
<br>
&nbsp;&nbsp;The BUILD number is bumped by one on each point release, except when we do<br>
&nbsp;&nbsp;our "traditional" Christmas release, then we bump MINOR and reset BUILD to 0.<br>
<br>
&nbsp;&nbsp;For massive changes we can decide to bump MAJOR and set MINOR and BUILD to 0,<br>
&nbsp;&nbsp;for example when merging the 'vice-4' branch somewhere in the future.<br>
<br>
- propagate the updated version into the documentation:<br>
<br>
$ touch doc/vice.texi<br>
$ make all<br>
<br>
This will update the user-visible version in the binary/docs (README, index.html<br>
etc), so it should happen only immediately before the release.<br>
<br>
while at it, also check the following:<br>
<br>
- are the "banners" on various sourceforge pages (tickets) still up to date?<br>
- are the "readmes" in the files areas still up to date?<br>
<br>
Make sure everything is fine, and commit the release<br>
<br>
$ svn commit -m "this is the 3.8.0 release - merry xmas"<br>
<br>
<br>
****************************************<br>
 Tarball verification using Github<br>
****************************************<br>
<br>
&nbsp;&nbsp;The file in .github/workflows/check-make-dist.yml contains a worflow to check<br>
&nbsp;&nbsp;if `make dist` works for all UIs, with `make dist` being run configured for<br>
&nbsp;&nbsp;each UI and then a Linux `configure &amp;&amp; make &amp;&amp; make install` being run for<br>
&nbsp;&nbsp;each UI for the generated tarballs, so currently nine combinations of<br>
&nbsp;&nbsp;`make dist` and `make [install]`.<br>
<br>
&nbsp;&nbsp;To trigger this workflow go to:<br>
&nbsp;&nbsp;https://github.com/VICE-Team/svn-mirror/actions/workflows/check-make-dist.yml<br>
&nbsp;&nbsp;Click on the "Run workflow" dropdown and click on the "Run workflow" button.<br>
<br>
&nbsp;&nbsp;The process usually takes about 7 minutes to finish if successful. If not<br>
&nbsp;&nbsp;successful check the logs and fix missing files in Makefile.am files.<br>
<br>
****************************************<br>
 Tarball and Windows Builds - Automated<br>
****************************************<br>
<br>
&nbsp;&nbsp;The file in .github/workflows/make-release.yml implements a release process that<br>
&nbsp;&nbsp;will create the dist tarball and then windows builds from that tarball. To trigger it,<br>
&nbsp;&nbsp;push a git tag like v3.8.0 to our github mirror. This will create a release on Github<br>
&nbsp;&nbsp;which can be seen at https://github.com/VICE-Team/svn-mirror/releases. The build<br>
&nbsp;&nbsp;process can be observed at https://github.com/VICE-Team/svn-mirror/actions.<br>
<br>
&nbsp;&nbsp;Please note that the 'clean' git branch is a direct sync from our svn repo. The 'main'<br>
&nbsp;&nbsp;branch adds in the Readme.md file that is displayed on Github but not present in the<br>
&nbsp;&nbsp;svn repo.<br>
<br>
&nbsp;&nbsp;Before triggering the build, you might want to make sure that the most recent SVN commit<br>
&nbsp;&nbsp;has a nice commit message about the release, as this will appear in certain places in<br>
&nbsp;&nbsp;Github. Make sure that the commit has synchronised over to Github before you trigger the<br>
&nbsp;&nbsp;build process.<br>
<br>
&nbsp;&nbsp;$ RELEASE=3.8.0<br>
<br>
&nbsp;&nbsp;$ git clone --branch clean --depth 1 git@github.com:VICE-Team/svn-mirror.git<br>
&nbsp;&nbsp;&nbsp;&nbsp; or if that doesnt work because github doesnt have your ssh key:<br>
&nbsp;&nbsp;$ git clone --branch clean --depth 1 https://github.com/VICE-Team/svn-mirror.git<br>
<br>
&nbsp;&nbsp;$ cd svn-mirror<br>
<br>
&nbsp;&nbsp;$ git tag $RELEASE<br>
&nbsp;&nbsp;$ git push origin $RELEASE<br>
<br>
&nbsp;&nbsp;Pushing the tag triggers the release build, and creates a 'release' on Github called 3.8.0.<br>
&nbsp;&nbsp;Annoyingly, this release will automatically include a zip and tgz of the source for that<br>
&nbsp;&nbsp;commit, without any way to prevent it.<br>
<br>
&nbsp;&nbsp;OOOOPS! now something doesnt work as intended - for example the release creation<br>
&nbsp;&nbsp;itself fails for some reason. Now you can revert the tag like this:<br>
<br>
&nbsp;&nbsp;$ git tag -d $RELEASE<br>
&nbsp;&nbsp;$ git push --delete origin $RELEASE<br>
<br>
&nbsp;&nbsp;Now fix your stuff, commit to svn, and if you are ready push the tag again:<br>
<br>
&nbsp;&nbsp;$ git tag $RELEASE<br>
&nbsp;&nbsp;$ git push origin $RELEASE<br>
<br>
*************************************<br>
 Tarball and Windows Builds - Manual<br>
*************************************<br>
<br>
&nbsp;&nbsp;generate tarball:<br>
&nbsp;&nbsp;-----------------<br>
<br>
&nbsp;&nbsp;(make sure dos2unix is installed)<br>
<br>
&nbsp;&nbsp;first update and clean your source tree<br>
<br>
&nbsp;&nbsp;$ svn up<br>
&nbsp;&nbsp;$ make distclean<br>
<br>
&nbsp;&nbsp;now configure the source tree with sid engines included. this is<br>
&nbsp;&nbsp;needed because make dist propagates through the source tree, and if resid is<br>
&nbsp;&nbsp;not configured it will not have any makefiles to get 'make dist'ed<br>
<br>
&nbsp;&nbsp;$ ./autogen.sh<br>
&nbsp;&nbsp;$ ./configure --with-resid<br>
&nbsp;&nbsp;$ make dist<br>
<br>
&nbsp;&nbsp;now unpack into a separate directory and test if compiling works. fix makefiles<br>
&nbsp;&nbsp;in case files are missing and build the tarball again.<br>
<br>
&nbsp;&nbsp;generate windows binaries:<br>
&nbsp;&nbsp;--------------------------<br>
<br>
&nbsp;&nbsp;in msys2 configure the source as described above, then do<br>
<br>
&nbsp;&nbsp;$ make bindistzip<br>
<br>
*************************************<br>
<br>
create a tagged branch on the svn<br>
---------------------------------<br>
<br>
&nbsp;&nbsp;$ svn cp &lt;url of svn trunk&gt; &lt;url of svn tag&gt;<br>
<br>
&nbsp;&nbsp;e.g.<br>
<br>
&nbsp;&nbsp;$ svn cp --username=gpz -r &lt;revision of release&gt; svn+ssh://gpz@svn.code.sf.net/p/vice-emu/code/trunk/ svn+ssh://gpz@svn.code.sf.net/p/vice-emu/code/tags/v3.4/<br>
<br>
<br>
publish the release<br>
-------------------<br>
<br>
- upload changes to the website on sf (don't forget the html documentation)<br>
<br>
- upload the tarball to sf<br>
<br>
- in the file list (downloads) on sf, click on the (I) symbol on the right of<br>
&nbsp;&nbsp;the new file(s) and then set it to the respective platform to change the<br>
&nbsp;&nbsp;default downloads<br>
<br>
- announce the release on the ml (and eventually elsewhere)<br>
<br>
- update the TODO wiki page (remove old crossed out things)<br>
<br>
- PROFIT!!!<br>
</tt>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Developer Information</a></li>
    <li class="footer">Generated on Sun Jun 16 2024 16:42:49 for vsid by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
